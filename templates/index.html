<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HideAndSeek</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/icon.png') }}">
</head>
<body>

  <header class="site-header">
    <div class="header-inner">
      <div class="brand">
        <img src="{{ url_for('static', filename='images/logo_min.png') }}" alt="HideAndSeek" class="logo-min">
        <div class="brand-text">
          <h1>HideAndSeek</h1>
        </div>
      </div>
    </div>
  </header>

  <main class="page-main">
    <div class="content">

      <div class="controls">
        <label class="mode">
          <input type="checkbox" id="modeSwitch" aria-label="Toggle mode" {% if mode=="decode" %}checked{% endif %}>
          <span class="mode-slider"></span>
        </label>
        <span id="modeLabel">Mode: {{ mode|capitalize }}</span>
      </div>

      <section id="encode-section" class="panel {% if mode=="encode" %}active{% endif %}">
        <h2>Encode message</h2>
        <form method="POST" enctype="multipart/form-data" class="form">
          
          <label class="field">
            <span class="label">Choose PNG image</span>
            <input type="file" name="file" accept=".png" required>
          </label>

          <label class="field">
            <span class="label">Encoding method</span>
            <select name="method" id="method-encode" required>
              <option value="lsb" selected>LSB (Least Significant Bit)</option>
            </select>
          </label>

          <label class="field">
            <span class="label">Secret message</span>
            <textarea name="hidden_message" rows="4" placeholder="Type your secret message..." required></textarea>
          </label>

          <div class="actions">
            <button type="submit" name="action" value="encode" class="btn primary">Encode</button>
          </div>
        </form>

        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, msg in messages %}
              {% if category == 'success' and processed %}
                <div class="notice-card notice-success">
                  <div class="notice-header">✅ Encode Successful</div>
                  <div class="notice-body">
                    <p>{{ msg }}</p>
                    <a href="{{ url_for('download_file') }}" class="btn primary">Download Stego Image</a>
                  </div>
                </div>
              {% elif category == 'error' %}
                <div class="notice-card notice-error">
                  <div class="notice-header">❌ Error</div>
                  <div class="notice-body">{{ msg }}</div>
                </div>
              {% endif %}
            {% endfor %}
          {% endif %}
        {% endwith %}

      </section>

      <section id="decode-section" class="panel {% if mode=="decode" %}active{% endif %}">
        <h2>Decode message</h2>
        <form method="POST" enctype="multipart/form-data" class="form">

          <label class="field">
            <span class="label">Choose PNG image</span>
            <input type="file" name="file" accept=".png" required>
          </label>

          <label class="field">
            <span class="label">Decoding method</span>
            <select name="method" id="method-decode" required>
              <option value="lsb" selected>LSB (Least Significant Bit)</option>
            </select>
          </label>

          <div class="actions">
            <button type="submit" name="action" value="decode" class="btn primary">Decode</button>
          </div>
        </form>

        {% if decoded_message %}
          <div class="notice-card notice-success">
            <div class="notice-header">✅ Decoded Message</div>
            <div class="notice-body">{{ decoded_message }}</div>
          </div>
        {% endif %}

        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, msg in messages %}
              {% if category == 'error' %}
                <div class="notice-card notice-error">
                  <div class="notice-header">❌ Error</div>
                  <div class="notice-body">{{ msg }}</div>
                </div>
              {% endif %}
            {% endfor %}
          {% endif %}
        {% endwith %}

      </section>

      <section class="info">
        <h3>How it works</h3>
        <p>
          HideAndSeek uses steganography to embed short messages inside PNG images. 
          Select an image, type your secret message and press <em>Encode</em>. 
          To read hidden messages use <em>Decode</em>.
        </p>
        <p class="small">Only PNG files are allowed.</p>
      </section>

    </div>
  </main>

  <footer class="site-footer">
    <div class="footer-inner">
      <img src="{{ url_for('static', filename='images/logo.png') }}" alt="HideAndSeek" class="logo-footer">
      <div class="footer-text">
        <p>&copy; 2025 HideAndSeek</p>
        <p class="small">Project for learning steganography</p>
      </div>
    </div>
  </footer>

  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
